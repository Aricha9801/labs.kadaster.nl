---
layout: default
title: About Data Stories
---
<div class="flex">
  <div class="flex-content">
    <h1>Kadaster SPARQL Editor (based on YASGUI)</h1>

    <h2>SPARQL Editor (YASQUE)<h2>

    <h3>Supported key combinations</h3>
    <p>
    The following key combinations are supported within the SPARQL Editor (YASQE).

    We sometimes use the notion of a <b>group</b>, wich is either one word
    (space-delimited sequence of non-space characters), a sequences of
    multiple whitespace characters, or one newline.
    </p>
    <p>
    <table>
      <thead>
        <tr><th><b>Key combination</b></th><th><b>Behavior</b></th></tr>
      </thead>
      <tbody>
        <tr><td><code>Alt + Left</code></td><td>Move the cursor to the beginning of the current line.</td></tr>
        <tr><td><code>Alt + Right</code></td><td>Move the cursor to the end of the current line.</td></tr>
        <tr><td><code>Alt + U</code></td><td>Redo the last change within the current selection.</td></tr>
        <tr><td><code>Ctrl + Backspace</code></td><td>Delete to the beginning of the group before the cursor.</td></tr>
        <tr><td><code>Ctrl + Delete</code></td><td>Delete to the beginning of the group after the cursor.</td></tr>
        <tr><td><code>Ctrl + End</code></td><td>Move the cursor to the end of the query.</td></tr>
        <tr><td><code>Ctrl + Home</code></td><td>Move the cursor to the start of the query.</td></tr>
        <tr><td><code>Ctrl + Left</code></td><td>Move the cursor to the left of the group before the cursor.</td></tr>
        <tr><td><code>Ctrl + Right</code></td><td>Move the cursor to the right of the group the cursor.</td></tr>
        <tr><td><code>Ctrl + [</code></td><td>Decrements the indentation for the current line or the lines involved in the current selection.</td></tr>
        <tr><td><code>Ctrl + ]</code></td><td>Increments the indentation for the current line or the lines involved in the current selection.</td></tr>
        <tr><td><code>Ctrl + /</code></td><td>Toggles on/off the commenting of the current line or the lines involved in the current selection.</td></tr>
        <tr><td><code>Ctrl + A</code></td><td>Select the whole query.</td></tr>
        <tr><td><code>Ctrl + D</code></td><td>Deletes the current line or all lines involved in the current selection.</td></tr>
        <tr><td><code>Ctrl + U</code></td><td>Unfo the last change within the current selection.</td></tr>
        <tr><td><code>Ctrl + Y</code></td><td>Redo the last undone edit action.</td></tr>
        <tr><td><code>Ctrl + Z</code></td><td>Undo the last edit action.</td></tr>
        <tr><td><code>Ctrl + Shift + F</code></td><td>Auto-formats the whole query or the lines involved in the current selection.</td></tr>
        <tr><td><code>Shift + Tab</code></td><td>Auto-indents the current line or the lines involved in the current selection.</td></tr>
        <tr><td><code>Tab</code></td><td>Indents the current line or the lines involved in the current selection.</td></tr>
    </tbody>
    </table>
    </p>
    <h2>SPARQL Result Set Viewer (YASR)</h2>

    <h3>SPARQL 2D</h3>
    <p>
    The following SPARQL variable names are used in the 2D visualization:
    <table>
      <thead>
        <tr><th><b>Variable name</b></th><th><b>Purpose</b></th></tr>
      </thead>
      <tbody>
        <tr><td><code>?shape</code></td><td>An arbitrary variable name that gets bound to literals with datatype <code>geo:wktLiteral</code>, and whose name is the prefix of the other variable names in this table.</td></tr>
        <tr><td><code>?shapeColor</code></td><td>The color of the shape bound to <code>?shape</code>.  Either a CSS3 color name, an RGB color code, or a value between 0.0 and 1.0 in combination with the name of a color palette.  The color palettes to choose from are (1) the ones defined by <a href="https://www.npmjs.com/package/colormap"><code>colormap</code></a> or (2) the ones defined by <a href="http://colorbrewer2.org/#type=sequential&scheme=BuGn&n=3">Color Brewer</a>.</td></tr>
        <tr><td><code>?shapeLabel</code></td><td>The text or HTML content of popups that appear when clicking the shape bound to <code>?shape</code>.</td></tr>
      </tbody>
    </table>
    </p>
    <h3>SPARQL 3D</h3>
    <p>
    In addition to the variables supported by SPARQL 2D, the following
    SPARQL variable names are used in the 3D visualization:

    <table>
      <thead>
        <tr><th><b>Variable name</b></th><th><b>Purpose</b></th></tr>
      </thead>
      <tbody>
        <tr><td><code>?shapeHeight</code></td><td>The height in meters of the 2.5D shape that is based on the 2D shape that is bound to <code>?shape</code>.</td></tr>
        <tr><td><code>?shapeOffset</code></td><td>The height in meters at which the 2.5D shape that is based on the 2D shape that is bound to <code>?shape</code> starts.</td></tr>
      </tbody>
    </table>
    </p>

    <h3>SPARQL Gallery</h3>
    <p>
    The following variable names are used in the gallery visualization:

    <table>
      <thead>
        <tr><th><b>Variable name</b></th><th><b>Purpose</b></th></tr>
      </thead>
      <tbody>
        <tr><td><code>?widget</code></td><td>A plain string or a literal with datatype IRI <code>rdf:HTML</code>, which is used as the content of the widgets that are displayed in gallery rows.</td></tr>
      </tbody>
    </table>
    </p>
    <h3>SPARQL Templating</h3>
    <p>
    It is often useful to create HTML snippets within a SPARQL query: this
    allows for moderately intuitive and human-readable visualizations of
    query results (e.g., in SPARQL Gallery, SPARQL 2D, or SPARQL 3D).

    Perfoming all string insertions in SPARQL works, but results in
    queries that are difficult to read and maintain:
  </p>
    <pre>
      <code>
    prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns# &gt;
    prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema# &gt;
    prefix rvo: &lt;https://data.labs.pdok.nl/def/ &gt;
    select * {
      [ a rvo:Land;
        rdfs:label ?land;
        rvo:hoofdstad/rdfs:label ?hoofdstad;
        rvo:munteenheid/rdfs:label ?munteenheid;
        rvo:vlag ?vlag].
        bind(strdt(concat(
             '&lt;h1&gt;',str(?land),'&lt;/h1&gt;',
             '&lt;figure&gt;',
               '&lt;img src="',str(?vlag),'" style="width: 300px;"&gt;',
               '&lt;figcaption&gt;In ',str(?land),' hanteert men als munteenheid de ',str(?munteenheid),'. De hoofdstad van ',str(?land),' is ',str(?hoofdstad),'.&lt;/figcaption&gt;',
             '&lt;/figure&gt;'), rdf:HTML, ?widget))
    }
    </code>
  </pre>
    </p>
    <p>
    YASGUI introduces SPARQL Templating, which allows one large string to
    be used, rather than a large number of small strings that are
    arguments to <code>concat</code>.  SPARQL variables <code>?abc</code> can be inserted into
    this one large string by using the <code>{{abc}}</code> templating notation.

    In order for a SPARQL variable to be used in this way, it must occur
    in the outer projection, because YASGUI (and not the server) performs
    template substitution.
    </p>
      <pre>
          <code>
        prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns# &gt;
        prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema# &gt;
        prefix rvo: &lt;https://data.labs.pdok.nl/def/ &gt;
        select * {
          [ a rvo:Land;
            rdfs:label ?land;
            rvo:hoofdstad/rdfs:label ?hoofdstad;
            rvo:munteenheid/rdfs:label ?munteenheid;
            rvo:vlag ?vlag].
          bind('''
               &lt;h1&gt;{{land}}&lt;/h1&gt;
                 &lt;figure&gt;
                   &lt;img src={{vlag}} style="width: 300px;"&gt;
                   &lt;figcaption&gt;In {{land}} hanteert men als munteenheid de {{munteenheid}}. De hoofdstad van {{land}} is {{hoofdstad}}.&lt;/figcaption&gt;
                &lt;/figure&gt;'''^^rdf:HTML as ?widget)
        }
      </code>
    </pre>
    <h2>Kadaster Data Stories</h2>
    <p>
    Data Stories is a way to publish SPARQL query results in a
    human-readable way.
    </p>
    <h3>Stories and Queries</h3>
    <p>
    Data Stories defines the following two HTML elements:
    <ul>
      <li><code>&lt;div class="story"&gt;</code>: The tag that contains zero or more <code>&lt;query&gt;</code> tags and that implements the Data Story.</li>
      <li><code>&lt;query&gt;</code>: The tag that implements one query within the Data Story.</li>
    </ul>
    </p>
    </h4>Story element</h4>
    <p>
    The following attributes are defined on a <i>data story</i> element:
    <ul>
      <li><code>data-endpoint</code>: The URI of the SPARQL endpoint against which all
        queries in the Data Story are executed.</li>
      <li><code>data-output</code>: The output format that is used to display SPARQL
        result sets in.  The following values are supported:</li>
      <li><code>boolean</code>: Shows the result of an <code>ask</code> query.</li>
      <li><code>error</code>: TODO</li>
      <li><code>gallery</code>: Shows HTML widgets in card rows.</li>
      <li><code>gchart</code>: Shows a UI for selecting numeric properties in order
        to generate various diagrams.</li>
      <li><code>geo</code>: Shows GeoSPARQL results on a 2D map.</li>
      <li><code>geo3d</code>: Shows GeoSPARQL results on a 3D map.</li>
      <li><code>pivot</code>: Shows a UI for selecting numeric properties in order to
        generate various diagrams and pivot tables.</li>
      <li><code>raw</code>: The textual content of the HTTP reply body. For example,
        the SPARQL result set serialized in XML, JSON, or CSV.</li>
      <li><code>table</code>: Shows the results in rows of an HTML table.  This is
        the default value.</li>
    <ul>
    </p>
    <h4>Query element</h4>
    <p>
    The following attributes are defined on the <code>query</code> element:
    <ul>
      <li><code>data-config="URI"</code>: A URI that encodes a query together with the
        configuration of a specific view.  These URIs can be created
        within the SPARQL IDE.</li>
      <li><code>data-endpoint="URI"</code>: The URI of the SPARQL endpoint against
        which a particular query is evaluated.  When absent, the value of
        this attribute on the <code>&lt;div class="story"&gt;</code> tag is used.</li>
      <li><code>data-query-ref="URI"</code>: An absolute or relative URI to a file that
        stores a SPARQL query.</li>
      <li><code>data-output="VALUE"</code>: The output format that is used to display
        the SPARQL result set.  When absent, the value of this attribute
        on the <code>&lt;div class="story"&gt;</code> tag is used.  See the documentation
        of the Story element for the supported values.</li>
      <li><code>data-show-query</code>: Used to show the query directly to the user.</li>
    </ul>
    </p>
  </div>
</div>
